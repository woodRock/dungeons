pico-8 version 36
__lua__
-- stealth mode - pico-8
function _init()
	gs="play"
	t=0
	
	player={x=16,y=16,vx=0,vy=0,sneak=false,det=0}
	exit={x=112,y=112}
	
	guards={}
	for i=1,3 do
		add(guards,{x=20+i*30,y=30+i*20,vx=flr(rnd(2))*2-1,vy=flr(rnd(2))*2-1,alert=0})
	end
	
	spots={{x=20,y=80,r=6},{x=90,y=30,r=6},{x=60,y=70,r=7}}
	walls={{x=30,y=40,w=25,h=3},{x=70,y=20,w=3,h=30},{x=20,y=70,w=50,h=3}}
end

function _update()
	t+=0.016
	
	if gs=="play" then
		local dx,dy=0,0
		if btn(0) then dx=-1 end
		if btn(1) then dx=1 end
		if btn(2) then dy=-1 end
		if btn(3) then dy=1 end
		if btnp(4) then player.sneak=not player.sneak end
		
		local spd=player.sneak and 0.4 or 1
		player.x+=dx*spd
		player.y+=dy*spd
		player.x=mid(8,player.x,120)
		player.y=mid(8,player.y,120)
		
		for g in all(guards) do
			g.x+=g.vx
			g.y+=g.vy
			if g.x<8 or g.x>120 then g.vx=-g.vx end
			if g.y<8 or g.y>120 then g.vy=-g.vy end
			g.alert=max(0,g.alert-0.01)
		end
		
		local hidden=false
		for s in all(spots) do
			if dist(player.x,player.y,s.x,s.y)<s.r then hidden=true end
		end
		
		player.det=0
		for g in all(guards) do
			local d=dist(player.x,player.y,g.x,g.y)
			local r=player.sneak and 10 or 20
			if hidden then r*=0.3 end
			if d<r then
				g.alert=1
				player.det+=1
				if player.det>120 then gs="caught" end
			end
		end
		
		if dist(player.x,player.y,exit.x,exit.y)<5 then gs="won" end
	else
		if btnp(4) then _init() end
	end
end

function dist(x1,y1,x2,y2)
	local dx,dy=x2-x1,y2-y1
	return sqrt(dx*dx+dy*dy)
end

function _draw()
	cls(1)
	
	for w in all(walls) do
		rectfill(w.x,w.y,w.x+w.w,w.y+w.h,5)
	end
	
	for s in all(spots) do
		circfill(s.x,s.y,s.r,2)
	end
	
	circfill(exit.x,exit.y,3,11)
	
	for g in all(guards) do
		local c=8
		if g.alert>0.5 then c=8 end
		circfill(g.x,g.y,2,c)
	end
	
	local pc=3
	if player.det>0 then pc=2 end
	if player.sneak then pc=5 end
	circfill(player.x,player.y,2,pc)
	
	print("time:"..flr(t),5,5,7)
	if player.sneak then print("sneak",60,5,7) end
	if player.det>0 then print("detected!",70,122,2) end
	
	if gs=="won" then
		print("escaped!",50,60,11)
		print("time:"..flr(t).."s",50,70,7)
		print("press z restart",40,85,7)
	elseif gs=="caught" then
		print("caught!",55,60,2)
		print("press z restart",40,70,7)
	else
		print("arrows:move z:sneak",5,122,7)
	end
end

__gfx__
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
